<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      loading-screen="enabled: false"
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets>
        <video
          id="vid1"
          src="./assets/video1.mp4"
          preload="auto"
          loop
          muted
          playsinline
          webkit-playsinline
          crossorigin="anonymous"
        ></video>
        <video
          id="vid2"
          src="./assets/video2.mp4"
          preload="auto"
          loop
          muted
          playsinline
          webkit-playsinline
          crossorigin="anonymous"
        ></video>
      </a-assets>

      <!-- Marker 1 -->
      <a-marker
        type="pattern"
        url="assets/m01.patt"
        emitevents="true"
        id="marker1"
      >
        <a-video
          src="#vid1"
          width="2"
          height="1.125"
          rotation="-270 0 0"
          autoplay="true"
          visible="true"
        ></a-video>
      </a-marker>

      <!-- Marker 2 -->
      <a-marker
        type="pattern"
        url="assets/m02.patt"
        emitevents="true"
        id="marker2"
      >
        <a-video
          src="#vid2"
          width="2"
          height="1.125"
          rotation="-270 0 0"
          autoplay="true"
          visible="true"
        ></a-video>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const videos = document.querySelectorAll("video");
      videos.forEach(v => {
        v.muted = true;
        v.play().catch(() => {}); 
      });

      const scene = document.querySelector("a-scene");

      scene.addEventListener("markerFound", (e) => {
        const markerId = e.target.id;
        console.log("Marker Found:", markerId);
        const vid = document.querySelector(`#${markerId.replace("marker", "vid")}`);
        if (vid) {
          vid.play().then(() => console.log("play:", vid.id));
        }
      });

      scene.addEventListener("markerLost", (e) => {
        const markerId = e.target.id;
        console.log("Marker Lost:", markerId);
        const vid = document.querySelector(`#${markerId.replace("marker", "vid")}`);
        if (vid) {
          vid.pause();
        }
      });
    </script>
  </body>
</html>
